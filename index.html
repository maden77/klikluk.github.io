<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RPG Sederhana</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background-color: #222;
      color: #eee;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }
    
    #game-container {
      width: 800px;
      max-width: 95%;
      background-color: #333;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 0 20px rgba(0,0,0,0.5);
      margin: 20px 0;
    }
    
    #game-screen {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 20px;
    }
    
    #map {
      background-color: #111;
      height: 400px;
      border-radius: 5px;
      position: relative;
      overflow: hidden;
    }
    
    #player {
      width: 30px;
      height: 30px;
      background-color: #4CAF50;
      border-radius: 50%;
      position: absolute;
      transition: all 0.3s ease;
      z-index: 10;
    }
    
    .enemy {
      width: 25px;
      height: 25px;
      background-color: #F44336;
      border-radius: 50%;
      position: absolute;
      z-index: 5;
    }
    
    .item {
      width: 20px;
      height: 20px;
      background-color: #FFC107;
      border-radius: 50%;
      position: absolute;
      z-index: 3;
    }
    
    .obstacle {
      background-color: #795548;
      position: absolute;
      z-index: 2;
    }
    
    #stats {
      background-color: #444;
      padding: 15px;
      border-radius: 5px;
    }
    
    .stat-bar {
      height: 20px;
      background-color: #555;
      border-radius: 10px;
      margin-bottom: 10px;
      overflow: hidden;
    }
    
    .stat-fill {
      height: 100%;
      border-radius: 10px;
    }
    
    #health .stat-fill {
      background-color: #F44336;
      width: 100%;
    }
    
    #mana .stat-fill {
      background-color: #2196F3;
      width: 80%;
    }
    
    #exp .stat-fill {
      background-color: #4CAF50;
      width: 30%;
    }
    
    #inventory {
      margin-top: 20px;
    }
    
    #inventory-items {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    
    .inventory-item {
      width: 40px;
      height: 40px;
      background-color: #555;
      border-radius: 5px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }
    
    #controls {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-top: 20px;
    }
    
    button {
      padding: 10px;
      background-color: #4CAF50;
      border: none;
      border-radius: 5px;
      color: white;
      cursor: pointer;
      font-weight: bold;
    }
    
    button:hover {
      background-color: #45a049;
    }
    
    #action-buttons {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }
    
    #action-buttons button {
      flex: 1;
    }
    
    #attack {
      background-color: #F44336;
    }
    
    #attack:hover {
      background-color: #d32f2f;
    }
    
    #use-item {
      background-color: #FFC107;
      color: #333;
    }
    
    #use-item:hover {
      background-color: #ffb300;
    }
    
    #message-log {
      margin-top: 20px;
      height: 100px;
      overflow-y: auto;
      background-color: #111;
      padding: 10px;
      border-radius: 5px;
    }
    
    .message {
      margin: 5px 0;
      padding: 5px;
      border-radius: 3px;
    }
    
    .info {
      background-color: rgba(33, 150, 243, 0.2);
    }
    
    .damage {
      background-color: rgba(244, 67, 54, 0.2);
    }
    
    .heal {
      background-color: rgba(76, 175, 80, 0.2);
    }
    
    #game-over {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.8);
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 100;
    }
    
    #game-over h2 {
      color: #F44336;
      font-size: 3em;
      margin-bottom: 20px;
    }
    
    @media (max-width: 600px) {
      #game-screen {
        grid-template-columns: 1fr;
      }
      
      #map {
        height: 300px;
      }
    }
  </style>
</head>
<body>
  <h1>RPG Sederhana</h1>
  
  <div id="game-container">
    <div id="game-screen">
      <div id="map">
        <div id="player"></div>
        <!-- Musuh dan item akan ditambahkan secara dinamis -->
      </div>
      
      <div id="stats">
        <h2>Status</h2>
        <div>
          <h3>Pemain</h3>
          <p>Level: <span id="player-level">1</span></p>
          
          <div class="stat-bar" id="health">
            <div class="stat-fill" id="health-fill"></div>
          </div>
          <p>HP: <span id="hp-text">100/100</span></p>
          
          <div class="stat-bar" id="mana">
            <div class="stat-fill" id="mana-fill"></div>
          </div>
          <p>Mana: <span id="mana-text">50/50</span></p>
          
          <div class="stat-bar" id="exp">
            <div class="stat-fill" id="exp-fill"></div>
          </div>
          <p>EXP: <span id="exp-text">0/100</span></p>
        </div>
        
        <div id="inventory">
          <h3>Inventory</h3>
          <div id="inventory-items">
            <!-- Item akan ditambahkan secara dinamis -->
          </div>
        </div>
      </div>
    </div>
    
    <div id="controls">
      <button id="up">↑</button>
      <button id="left">←</button>
      <button id="right">→</button>
      <button id="down">↓</button>
      <button id="wait">Tunggu</button>
      <button id="rest">Istirahat</button>
    </div>
    
    <div id="action-buttons">
      <button id="attack">Serang</button>
      <button id="use-item">Gunakan Item</button>
    </div>
    
    <div id="message-log">
      <div class="message info">Selamat datang di RPG Sederhana!</div>
      <div class="message info">Gunakan tombol arah untuk bergerak.</div>
    </div>
  </div>
  
  <div id="game-over">
    <h2>GAME OVER</h2>
    <button id="restart">Main Lagi</button>
  </div>
  
  <script>
    // Game state
    const gameState = {
      player: {
        x: 100,
        y: 100,
        maxHp: 100,
        hp: 100,
        maxMana: 50,
        mana: 50,
        attack: 10,
        defense: 5,
        level: 1,
        exp: 0,
        nextLevelExp: 100,
        inventory: [
          { id: 'potion', name: 'Potion', effect: { hp: 20 }, quantity: 3 },
          { id: 'mana-potion', name: 'Mana Potion', effect: { mana: 15 }, quantity: 2 }
        ]
      },
      enemies: [],
      items: [],
      obstacles: [],
      gameOver: false,
      currentEnemy: null,
      messages: [
        { text: 'Selamat datang di RPG Sederhana!', type: 'info' },
        { text: 'Gunakan tombol arah untuk bergerak.', type: 'info' }
      ]
    };

    // DOM elements
    const playerElement = document.getElementById('player');
    const mapElement = document.getElementById('map');
    const hpText = document.getElementById('hp-text');
    const manaText = document.getElementById('mana-text');
    const expText = document.getElementById('exp-text');
    const playerLevel = document.getElementById('player-level');
    const healthFill = document.getElementById('health-fill');
    const manaFill = document.getElementById('mana-fill');
    const expFill = document.getElementById('exp-fill');
    const inventoryItems = document.getElementById('inventory-items');
    const messageLog = document.getElementById('message-log');
    const gameOverScreen = document.getElementById('game-over');
    const restartButton = document.getElementById('restart');

    // Initialize game
    function initGame() {
      // Reset player position
      gameState.player.x = 100;
      gameState.player.y = 100;
      gameState.player.hp = gameState.player.maxHp;
      gameState.player.mana = gameState.player.maxMana;
      gameState.gameOver = false;
      gameState.currentEnemy = null;
      
      // Clear existing enemies and items
      gameState.enemies = [];
      gameState.items = [];
      
      // Create obstacles
      createObstacles();
      
      // Create enemies
      for (let i = 0; i < 5; i++) {
        createEnemy();
      }
      
      // Create items
      for (let i = 0; i < 3; i++) {
        createItem('potion');
      }
      for (let i = 0; i < 2; i++) {
        createItem('mana-potion');
      }
      
      // Update UI
      updatePlayerPosition();
      updateStats();
      updateInventory();
      
      // Hide game over screen
      gameOverScreen.style.display = 'none';
      
      // Add initial messages
      addMessage('Petualangan baru dimulai!', 'info');
    }

    // Create obstacles
    function createObstacles() {
      // Contoh obstacle (dinding di sekitar map)
      const mapWidth = mapElement.offsetWidth;
      const mapHeight = mapElement.offsetHeight;
      
      // Atas
      gameState.obstacles.push({ x: 0, y: 0, width: mapWidth, height: 20 });
      
      // Bawah
      gameState.obstacles.push({ x: 0, y: mapHeight - 20, width: mapWidth, height: 20 });
      
      // Kiri
      gameState.obstacles.push({ x: 0, y: 0, width: 20, height: mapHeight });
      
      // Kanan
      gameState.obstacles.push({ x: mapWidth - 20, y: 0, width: 20, height: mapHeight });
      
      // Beberapa obstacle acak
      for (let i = 0; i < 10; i++) {
        const width = Math.random() * 50 + 20;
        const height = Math.random() * 50 + 20;
        const x = Math.random() * (mapWidth - width - 40) + 20;
        const y = Math.random() * (mapHeight - height - 40) + 20;
        
        gameState.obstacles.push({ x, y, width, height });
      }
      
      // Render obstacles
      renderObstacles();
    }

    // Render obstacles
    function renderObstacles() {
      // Hapus obstacle yang ada
      document.querySelectorAll('.obstacle').forEach(el => el.remove());
      
      // Buat obstacle baru
      gameState.obstacles.forEach(obstacle => {
        const obstacleElement = document.createElement('div');
        obstacleElement.className = 'obstacle';
        obstacleElement.style.left = `${obstacle.x}px`;
        obstacleElement.style.top = `${obstacle.y}px`;
        obstacleElement.style.width = `${obstacle.width}px`;
        obstacleElement.style.height = `${obstacle.height}px`;
        mapElement.appendChild(obstacleElement);
      });
    }

    // Create enemy
    function createEnemy() {
      const mapWidth = mapElement.offsetWidth;
      const mapHeight = mapElement.offsetHeight;
      
      // Pastikan musuh tidak muncul di dekat player
      let x, y;
      do {
        x = Math.random() * (mapWidth - 40) + 20;
        y = Math.random() * (mapHeight - 40) + 20;
      } while (Math.abs(x - gameState.player.x) < 100 && Math.abs(y - gameState.player.y) < 100);
      
      const level = Math.floor(Math.random() * 3) + 1;
      const maxHp = 20 + (level - 1) * 10;
      
      const enemy = {
        id: `enemy-${Date.now()}-${Math.floor(Math.random() * 1000)}`,
        x,
        y,
        maxHp,
        hp: maxHp,
        attack: 5 + (level - 1) * 2,
        defense: 2 + (level - 1),
        level,
        exp: 10 * level
      };
      
      gameState.enemies.push(enemy);
      renderEnemy(enemy);
    }

    // Render enemy
    function renderEnemy(enemy) {
      const enemyElement = document.createElement('div');
      enemyElement.className = 'enemy';
      enemyElement.id = enemy.id;
      enemyElement.style.left = `${enemy.x}px`;
      enemyElement.style.top = `${enemy.y}px`;
      
      // Tambahkan tooltip dengan info musuh
      enemyElement.title = `Musuh Level ${enemy.level}\nHP: ${enemy.hp}/${enemy.maxHp}`;
      
      mapElement.appendChild(enemyElement);
    }

    // Create item
    function createItem(type) {
      const mapWidth = mapElement.offsetWidth;
      const mapHeight = mapElement.offsetHeight;
      
      const x = Math.random() * (mapWidth - 40) + 20;
      const y = Math.random() * (mapHeight - 40) + 20;
      
      const item = {
        id: `item-${Date.now()}-${Math.floor(Math.random() * 1000)}`,
        x,
        y,
        type
      };
      
      gameState.items.push(item);
      renderItem(item);
    }

    // Render item
    function renderItem(item) {
      const itemElement = document.createElement('div');
      itemElement.className = 'item';
      itemElement.id = item.id;
      itemElement.style.left = `${item.x}px`;
      itemElement.style.top = `${item.y}px`;
      
      // Tambahkan tooltip
      if (item.type === 'potion') {
        itemElement.title = 'Potion (Restore 20 HP)';
      } else if (item.type === 'mana-potion') {
        itemElement.title = 'Mana Potion (Restore 15 Mana)';
      }
      
      mapElement.appendChild(itemElement);
    }

    // Update player position on screen
    function updatePlayerPosition() {
      playerElement.style.left = `${gameState.player.x}px`;
      playerElement.style.top = `${gameState.player.y}px`;
      
      // Cek collision dengan musuh
      checkEnemyCollision();
      
      // Cek collision dengan item
      checkItemCollision();
    }

    // Check enemy collision
    function checkEnemyCollision() {
      const playerSize = 30;
      const enemySize = 25;
      
      for (let i = 0; i < gameState.enemies.length; i++) {
        const enemy = gameState.enemies[i];
        
        if (
          gameState.player.x < enemy.x + enemySize &&
          gameState.player.x + playerSize > enemy.x &&
          gameState.player.y < enemy.y + enemySize &&
          gameState.player.y + playerSize > enemy.y
        ) {
          // Player bertemu musuh
          gameState.currentEnemy = enemy;
          addMessage(`Anda bertemu musuh level ${enemy.level}!`, 'info');
          return;
        }
      }
      
      // Tidak ada musuh yang bertemu
      gameState.currentEnemy = null;
    }

    // Check item collision
    function checkItemCollision() {
      const playerSize = 30;
      const itemSize = 20;
      
      for (let i = 0; i < gameState.items.length; i++) {
        const item = gameState.items[i];
        
        if (
          gameState.player.x < item.x + itemSize &&
          gameState.player.x + playerSize > item.x &&
          gameState.player.y < item.y + itemSize &&
          gameState.player.y + playerSize > item.y
        ) {
          // Player mengambil item
          pickUpItem(item);
          return;
        }
      }
    }

    // Pick up item
    function pickUpItem(item) {
      // Hapus item dari map
      document.getElementById(item.id)?.remove();
      gameState.items = gameState.items.filter(i => i.id !== item.id);
      
      // Tambahkan ke inventory
      const existingItem = gameState.player.inventory.find(i => i.id === item.type);
      if (existingItem) {
        existingItem.quantity++;
      } else {
        if (item.type === 'potion') {
          gameState.player.inventory.push({ 
            id: 'potion', 
            name: 'Potion', 
            effect: { hp: 20 }, 
            quantity: 1 
          });
        } else if (item.type === 'mana-potion') {
          gameState.player.inventory.push({ 
            id: 'mana-potion', 
            name: 'Mana Potion', 
            effect: { mana: 15 }, 
            quantity: 1 
          });
        }
      }
      
      addMessage(`Anda mendapatkan ${item.type === 'potion' ? 'Potion' : 'Mana Potion'}!`, 'info');
      updateInventory();
    }

    // Update player stats display
    function updateStats() {
      // Update HP
      const hpPercent = (gameState.player.hp / gameState.player.maxHp) * 100;
      healthFill.style.width = `${hpPercent}%`;
      hpText.textContent = `${gameState.player.hp}/${gameState.player.maxHp}`;
      
      // Update Mana
      const manaPercent = (gameState.player.mana / gameState.player.maxMana) * 100;
      manaFill.style.width = `${manaPercent}%`;
      manaText.textContent = `${gameState.player.mana}/${gameState.player.maxMana}`;
      
      // Update EXP
      const expPercent = (gameState.player.exp / gameState.player.nextLevelExp) * 100;
      expFill.style.width = `${expPercent}%`;
      expText.textContent = `${gameState.player.exp}/${gameState.player.nextLevelExp}`;
      
      // Update level
      playerLevel.textContent = gameState.player.level;
    }

    // Update inventory display
    function updateInventory() {
      inventoryItems.innerHTML = '';
      
      gameState.player.inventory.forEach(item => {
        const itemElement = document.createElement('div');
        itemElement.className = 'inventory-item';
        itemElement.textContent = item.id === 'potion' ? 'P' : 'MP';
        itemElement.title = `${item.name} (${item.quantity})`;
        
        itemElement.addEventListener('click', () => useItem(item));
        
        inventoryItems.appendChild(itemElement);
      });
    }

    // Use item
    function useItem(item) {
      if (item.quantity <= 0) return;
      
      if (item.id === 'potion') {
        gameState.player.hp = Math.min(gameState.player.hp + item.effect.hp, gameState.player.maxHp);
        addMessage(`Anda menggunakan Potion! Pulihkan ${item.effect.hp} HP.`, 'heal');
      } else if (item.id === 'mana-potion') {
        gameState.player.mana = Math.min(gameState.player.mana + item.effect.mana, gameState.player.maxMana);
        addMessage(`Anda menggunakan Mana Potion! Pulihkan ${item.effect.mana} Mana.`, 'heal');
      }
      
      item.quantity--;
      if (item.quantity <= 0) {
        gameState.player.inventory = gameState.player.inventory.filter(i => i.id !== item.id);
      }
      
      updateStats();
      updateInventory();
    }

    // Attack enemy
    function attackEnemy() {
      if (!gameState.currentEnemy) {
        addMessage('Tidak ada musuh di dekatmu!', 'info');
        return;
      }
      
      const enemy = gameState.currentEnemy;
      
      // Hitung damage player ke musuh
      const playerDamage = Math.max(1, gameState.player.attack - enemy.defense / 2);
      enemy.hp -= playerDamage;
      
      addMessage(`Anda menyerang musuh dan memberikan ${playerDamage} damage!`, 'damage');
      
      // Update enemy HP display
      const enemyElement = document.getElementById(enemy.id);
      if (enemyElement) {
        enemyElement.title = `Musuh Level ${enemy.level}\nHP: ${Math.max(0, enemy.hp)}/${enemy.maxHp}`;
      }
      
      // Cek jika musuh mati
      if (enemy.hp <= 0) {
        addMessage(`Anda mengalahkan musuh level ${enemy.level}! Mendapatkan ${enemy.exp} EXP.`, 'info');
        
        // Beri EXP ke player
        gameState.player.exp += enemy.exp;
        
        // Cek level up
        checkLevelUp();
        
        // Hapus musuh
        document.getElementById(enemy.id)?.remove();
        gameState.enemies = gameState.enemies.filter(e => e.id !== enemy.id);
        gameState.currentEnemy = null;
        
        // Buat musuh baru
        if (gameState.enemies.length < 3) {
          createEnemy();
        }
        
        updateStats();
        return;
      }
      
      // Musuh menyerang balik
      const enemyDamage = Math.max(1, enemy.attack - gameState.player.defense / 2);
      gameState.player.hp -= enemyDamage;
      
      addMessage(`Musuh menyerang balik dan memberikan ${enemyDamage} damage!`, 'damage');
      
      // Update player stats
      updateStats();
      
      // Cek game over
      if (gameState.player.hp <= 0) {
        gameOver();
      }
    }

    // Check level up
    function checkLevelUp() {
      if (gameState.player.exp >= gameState.player.nextLevelExp) {
        gameState.player.level++;
        gameState.player.exp -= gameState.player.nextLevelExp;
        gameState.player.nextLevelExp = Math.floor(gameState.player.nextLevel
